<%- include('./layouts/header') %>
<%- include('./layouts/navbar') %>

<style>
    .review-container {
        padding: 2rem;
        max-width: 800px;
        margin: auto;
    }

    .review-container h1,
    .review-container h2 {
        color: #2c3e50;
        text-align: center;
    }

    .review-form {
        display: flex;
        flex-direction: column;
        margin-bottom: 2rem;
    }

    .review-form textarea {
        padding: 10px;
        font-size: 16px;
        resize: vertical;
        border-radius: 8px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
    }

    .review-form input[type=number] {
        width: 60px;
        padding: 6px;
        font-size: 16px;
        margin-bottom: 10px;
        border-radius: 6px;
        border: 1px solid #ccc;
    }

    .review-form button {
        width: fit-content;
        padding: 8px 16px;
        background-color: #2ecc71;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
    }

    .review-list li {
        margin-bottom: 15px;
        border-left: 5px solid #3498db;
        padding: 10px;
        background-color: #f9f9f9;
        border-radius: 6px;
    }

    .review-list small {
        color: #7f8c8d;
    }

    .stars {
        margin-bottom: 6px;
        font-size: 1.1rem;
    }
</style>

<div class="review-container">
    <h1>User Reviews</h1>
    <p style="text-align:center;color:#7f8c8d;margin-bottom:30px;">
        Share your experience with your approved reservations. Your feedback helps us improve!
    </p>

    <!-- ADD REVIEW SECTION -->
    <h2>Leave a Review</h2>
    <form method="POST" action="/user/reviews" class="review-form">
        <textarea 
          name="message" 
          rows="4" 
          placeholder="Write your thoughts about your experience..."
          required><%= reviews[0]?.message || '' %></textarea>

        <label for="rating">Rating (1-5 stars)</label>
        <input 
          type="number" 
          name="rating" 
          min="1" max="5" 
          value="<%= reviews[0]?.rating || 5 %>" 
          required
        >

        <button type="submit"><%= reviews.length > 0 ? 'Update Review' : 'Submit Review' %></button>
    </form>

    <hr style="margin:40px 0;opacity:.3;">

    <!-- LIST REVIEWS -->
    <h2>Your Submitted Reviews</h2>

    <% if (reviews && reviews.length > 0) { %>
      <ul class="review-list">
          <% reviews.forEach(review => { %>
              <li>
                  <div class="stars">
                    <% for(let i=1;i<=5;i++){ %>
                        <%= i <= review.rating ? '⭐' : '☆' %>
                    <% } %>
                  </div>
                  <%= review.message %><br>
                  <small>
                    Submitted on <%= new Date(review.createdAt).toLocaleString() %>
                  </small>
              </li>
          <% }) %>
      </ul>
    <% } else { %>
      <p style="text-align:center;color:#999;">
        You haven’t submitted any reviews yet.
      </p>
    <% } %>
</div>

<%- include('./layouts/footer') %>
