<%- include('./layouts/header') %>
<%- include('./layouts/navbar') %>

<style>
/* ===== GENERAL PAGE LAYOUT ===== */
body {
    background: #eef3f7;
    font-family: "Inter", sans-serif;
}

.page-wrapper {
    display: flex;
    gap: 2rem;
    padding: 2rem;
    justify-content: center;
    flex-wrap: wrap;
}

/* ===== REVIEW PANEL ===== */
.review-panel {
    flex: 1 1 480px;
    max-width: 700px;
    background: #ffffff;
    padding: 2rem 2.5rem;
    border-radius: 14px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    border: 1px solid #e7e7e7;
}

.review-panel h1,
.review-panel h2 {
    text-align: center;
    color: #1c352d;
}

.review-panel p {
    text-align: center;
    color: #666;
    margin-bottom: 25px;
}

/* FORM */
.review-form textarea {
    width: 100%;
    padding: 14px;
    border: 1px solid #cfd4da;
    font-size: 15px;
    border-radius: 10px;
    resize: vertical;
    background: #fafafa;
    transition: .2s;
}

.review-form textarea:focus {
    border-color: #27ae60;
    background: #fff;
}

.star-rating {
    display: flex;
    justify-content: center;
    margin: 12px 0 15px;
    font-size: 2.2rem;
    cursor: pointer;
}

.star-rating span {
    color: #d0d0d0;
    transition: 0.25s;
}

.star-rating span.selected {
    color: #ffc240;
}

.star-rating span.hover {
    color: #ffd77a;
}

.review-form button {
    margin-top: 10px;
    padding: 12px 28px;
    border: none;
    background: #27ae60;
    color: #fff;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: 0.2s;
}

.review-form button:hover {
    background: #1f8b4e;
}

/* List of Reviews */
.review-list {
    padding: 0;
    margin-top: 20px;
}

.review-item {
    list-style: none;
    padding: 16px;
    margin-bottom: 15px;
    background: #ffffff;
    border-left: 5px solid #27ae60;
    border-radius: 10px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.06);
}

.review-item small {
    color: #7b8b8c;
}

/* Rating stars in submitted list */
.submitted-stars {
    color: #ffc240;
    font-size: 1.3rem;
    margin-bottom: 5px;
}

/* ===== EVENT PANEL ===== */
.event-panel {
    flex: 1 1 320px;
    max-width: 400px;
    background: #ffffff;
    padding: 1.8rem;
    border-radius: 14px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    border: 1px solid #e7e7e7;
    max-height: 650px;
    overflow-y: auto;
}

.event-panel h2 {
    text-align: center;
    margin-bottom: 1rem;
    color: #1c352d;
}

.event-card {
    background: #f9fafb;
    padding: 16px;
    border-radius: 10px;
    margin-bottom: 18px;
    border-left: 5px solid #27ae60;
}

.event-card img {
    width: 100%;
    border-radius: 8px;
    margin-bottom: 10px;
}

.event-card small {
    color: #758283;
}

/* ===== Responsiveness ===== */
@media (max-width: 900px) {
    .page-wrapper {
        flex-direction: column;
        padding: 1rem;
    }
}
</style>

<div class="page-wrapper">
    
    <!-- ========================= REVIEWS ========================= -->
    <div class="review-panel">
        <h1>User Reviews</h1>
        <p>Share your experience with your approved reservations. Your feedback helps us improve!</p>

        <!-- REVIEW FORM -->
        <h2>Leave a Review</h2>

        <form method="POST" action="/user/reviews" class="review-form">
            <textarea 
                name="message" 
                rows="4" 
                placeholder="Write your thoughts..."
                required><%= reviews[0]?.message || '' %></textarea>

            <div class="star-rating" id="starRating">
                <% for(let i=1;i<=5;i++){ %>
                    <span data-value="<%= i %>" 
                          class="<%= i <= (reviews[0]?.rating || 5) ? 'selected' : '' %>">
                          &#9733;
                    </span>
                <% } %>
            </div>

            <input type="hidden" name="rating" id="ratingInput" value="<%= reviews[0]?.rating || 5 %>">

            <button type="submit"><%= reviews.length > 0 ? 'Update Review' : 'Submit Review' %></button>
        </form>

        <hr style="margin:35px 0; opacity:.3;">

        <!-- SUBMITTED REVIEWS -->
        <h2>Your Submitted Reviews</h2>

        <% if (reviews && reviews.length > 0) { %>
            <ul class="review-list">
                <% reviews.forEach(review => { %>
                    <li class="review-item">
                        <div class="submitted-stars">
                            <% for(let i=1;i<=5;i++){ %>
                                <%= i <= review.rating ? '⭐' : '☆' %>
                            <% } %>
                        </div>
                        <strong><%= review.message %></strong><br>
                        <small>Submitted on <%= new Date(review.createdAt).toLocaleString() %></small>
                    </li>
                <% }) %>
            </ul>
        <% } else { %>
            <p style="text-align:center; color:#999;">You haven’t submitted any reviews yet.</p>
        <% } %>
    </div>

    <!-- ========================= EVENTS ========================= -->
    <div class="event-panel">
        <h2>Upcoming Events</h2>

        <% if (events && events.length > 0) { %>
            <% events.forEach(event => { %>
                <div class="event-card">
                    <% if (event.image) { %>
                        <img src="<%= event.image %>" alt="<%= event.title %>">
                    <% } %>
                    <strong><%= event.title %></strong>
                    <p><%= event.description %></p>
                    <small>
                        <%= new Date(event.date).toLocaleDateString() %> 
                        <%= event.time %> — 
                        <%= new Date(event.endDate).toLocaleDateString() %> 
                        <%= event.endTime %><br>
                        Location: <%= event.location %>
                    </small>
                </div>
            <% }) %>
        <% } else { %>
            <p style="text-align:center; color:#999;">No upcoming events available.</p>
        <% } %>
    </div>

</div>

<script>
const stars = document.querySelectorAll('#starRating span');
const ratingInput = document.getElementById('ratingInput');

stars.forEach(star => {
    star.addEventListener('click', () => {
        const value = star.dataset.value;
        ratingInput.value = value;

        stars.forEach(s => s.classList.remove('selected'));
        stars.forEach(s => {
            if (s.dataset.value <= value) s.classList.add('selected');
        });
    });

    star.addEventListener('mouseover', () => {
        const value = star.dataset.value;
        stars.forEach(s => s.classList.remove('hover'));
        stars.forEach(s => {
            if (s.dataset.value <= value) s.classList.add('hover');
        });
    });

    star.addEventListener('mouseout', () => {
        stars.forEach(s => s.classList.remove('hover'));
    });
});
</script>

<%- include('./layouts/footer') %>
