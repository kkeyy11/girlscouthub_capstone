<%- include('./layouts/header') %>
<%- include('./layouts/navbar') %>



<style>
body, main {
  font-family: 'Segoe UI', sans-serif;
  background-color: #f5f7fa;
}
main {
  margin-left: 220px;
  padding: 80px 20px 30px;
  min-height: 100vh;
  box-sizing: border-box;
}

/* üåü SUMMARY CARDS WITH DARK GREEN STYLE AND WHITE TEXT */
.summary-grid {
  display: grid;
  grid-auto-flow: column;
  grid-auto-columns: 40px;
  gap: 3px;
  overflow-x: auto;
  padding-bottom: 5px;
}

.custom-card {
  background: linear-gradient(135deg, #1b5e20, #2e7d32);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  padding: 8px;
  color: #fff;
}

.custom-card h2, .custom-card p {
  color: #fff;
}

.custom-card h2 {
  font-size: 16px;
  font-weight: 700;
  margin: 0;
}

.custom-card p {
  margin: 4px 0 0;
  font-size: 10px;
  text-align: center;
}


/* üåü CHARTS CONTAINER */
.charts-container {
  display: flex;
  gap: 20px;
  width: 82%;
  max-width: 100%;
}
.chart-card-left {
  flex: 2;
  min-width: 0;
  height: 320px;
  background: white;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.chart-card-right {
  flex: 1;
  min-width: 0;
  height: 320px;
  background: white;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.chart-header {
  font-size: 16px;
  font-weight: 600;
  color: #1b5e20;
  margin-bottom: 15px;
}

/* üåü TABLE */
.appointments-section table {
  width: 82%;
  border-collapse: collapse;
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
.appointments-section th {
  background-color: #1b5e20;
  color: white;
  text-align: left;
  padding: 12px;
}
.appointments-section td {
  padding: 12px;
  border-top: 1px solid #eee;
}

/* General fonts & colors */
h2, .chart-header {
  color: #1b5e20;
}
</style>
<main style="
  <%= user 
    ? 'margin-left: 220px; padding: 80px 30px 30px; background-color: #f8f9fa; max-width: none;' 
    : 'margin: 0; padding: 0; background-color: #2f5233; max-width: 100%;' %>
  min-height: 100vh;
  position: relative;
  width: 100%;
<% if (user && user.role && user.role.toLowerCase() === 'admin') { %>

<!-- ‚úÖ MAIN DASHBOARD CONTAINER -->
<div class="dashboard-container">

  <!-- ‚úÖ SUMMARY CARDS (Top Row) -->
  <div class="summary-grid">
    <div class="custom-card">
      <h2><%= districtCount %></h2>
      <p>Total Districts</p>
    </div>
    <div class="custom-card">
      <h2><%= latestAppointments?.length || 0 %></h2>
      <p>Total Appointments</p>
    </div>
    <div class="custom-card">
      <h2><%= productCount %></h2>
      <p>Total Products</p>
    </div>
    <div class="custom-card">
      <h2><%= events.length %></h2>
      <p>Upcoming Events</p>
    </div>
    <div class="custom-card revenue-card">
      <h2>‚Ç±<%= totalRevenue.toLocaleString() %></h2>
      <p>Total Revenue</p>
      <small>Total Sales Orders: <%= totalOrders %></small>
    </div>
  </div>

  <!-- ‚úÖ ANALYTICS SECTION (Second Row) -->
  <div class="analytics-grid">
    <div class="chart-card small-chart">
      <h6>Top Selling Products</h6>
      <canvas id="topProductsChart"></canvas>
    </div>
    <div class="chart-card small-chart">
      <h6>Sales by Category</h6>
      <canvas id="salesByCategoryChart"></canvas>
    </div>
    <div class="chart-card wide small-chart">
      <div class="chart-header">
        <h6>Revenue Trends</h6>
        <select id="revenueTrendSelect" class="form-select form-select-sm" style="width:auto;">
          <option value="monthly" selected>Monthly</option>
          <option value="weekly">Weekly</option>
          <option value="yearly">Yearly</option>
        </select>
      </div>
      <canvas id="revenueTrendsChart"></canvas>
    </div>
  </div>

  <!-- ‚úÖ TOP 3 SALES ORDERS (Third Row) -->
  <div class="chart-card small-chart">
    <h6>üèÜ Top 3 Sales Orders</h6>
    <div id="topSalesContainer"></div>
  </div>

  <!-- ‚úÖ LATEST APPOINTMENTS (Fourth Row) -->
  <section class="appointments-section">
    <h2>Latest Appointments</h2>
    <% if (latestAppointments && latestAppointments.length > 0) { %>
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-success">
            <tr>
              <th>User</th>
              <th>Date</th>
              <th>Time</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <% latestAppointments.forEach(app => { %>
              <tr>
                <td><%= app.user ? app.user.firstName + ' ' + app.user.lastName : 'N/A' %></td>
                <td><%= app.date.toDateString() %></td>
                <td><%= app.time %></td>
                <td>
                  <span class="badge bg-<%= app.status === 'Confirmed' ? 'success' : app.status === 'Cancelled' ? 'danger' : 'secondary' %>">
                    <%= app.status %>
                  </span>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <p class="text-muted">No recent appointments found.</p>
    <% } %>
  </section>

</div>

<style>
.dashboard-container {
  max-width: 1300px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 30px;
  padding-bottom: 40px;
}

/* SUMMARY CARDS */
.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
}

/* ANALYTICS GRID */
.analytics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
}
.chart-card {
  background: #fff;
  border-radius: 15px;
  padding: 15px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
.chart-card.wide {
  grid-column: span 2;
}
/* Smaller chart size */
.small-chart canvas {
  max-height: 220px !important;
}

/* APPOINTMENTS */
.appointments-section {
  background:#fff;
  padding:20px;
  border-radius:15px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
</style>





<% } else if (user) { %>
  <!-- üå∏ GIRL SCOUT MINDORO USER DASHBOARD -->
<!-- üå∏ V0-Style Girl Scout Mindoro User Dashboard -->
<div style="font-family: 'Poppins', sans-serif; background-color: #f5f7fa; color: #333;">

  <!-- üåü HERO SECTION -->
  <section style="
    width: 100%;
    min-height: 80vh;
    background: linear-gradient(to right, rgba(47, 82, 51, 0.85), rgba(47, 82, 51, 0.7)),
                url('/image/bg1.png') center/cover no-repeat;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 40px 20px;
    color: white;
  ">
    <h1 style="font-size: 48px; font-weight: 600; margin-bottom: 20px;">
      Welcome, <%= user.firstName || 'Girl Scout' %>! üåø
    </h1>
    <p style="font-size: 20px; max-width: 700px; opacity: 0.9;">
      Empowering young girls in Mindoro through leadership, service, and sisterhood.
    </p>
    <a href="#features" style="
      display: inline-block;
      margin-top: 30px;
      background: #ffcc00;
      color: #2f5233;
      padding: 14px 28px;
      font-weight: 500;
      border-radius: 30px;
      text-decoration: none;
      transition: all 0.3s;
    " onmouseover="this.style.background='#e6b800'" onmouseout="this.style.background='#ffcc00'">
      Explore Your Dashboard
    </a>
  </section>

  <!-- üåø FEATURES -->
  <section id="features" style="padding: 80px 20px; background: #ffffff;">
    <div style="
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 30px;
    ">
      <% const features = [
        { icon: 'fas fa-hand-holding-heart', title: 'Leadership', desc: 'Develop skills and confidence to lead your troop and community.' },
        { icon: 'fas fa-seedling', title: 'Growth', desc: 'Every badge earned is a step toward self-discovery and resilience.' },
        { icon: 'fas fa-users', title: 'Sisterhood', desc: 'Form lifelong friendships in a caring, inclusive environment.' },
        { icon: 'fas fa-hiking', title: 'Adventure', desc: 'Explore the outdoors and discover your strengths.' }
      ]; %>
      <% features.forEach(f => { %>
        <div style="
          background: #f9faf9;
          border: 1px solid #e0e0e0;
          border-radius: 12px;
          padding: 30px 20px;
          text-align: center;
          box-shadow: 0 2px 8px rgba(0,0,0,0.04);
          transition: transform 0.2s ease;
        " onmouseover="this.style.transform='translateY(-4px)'" onmouseout="this.style.transform='none'">
          <i class="<%= f.icon %>" style="font-size: 36px; color: #2f5233; margin-bottom: 15px;"></i>
          <h3 style="font-size: 20px; font-weight: 600; margin-bottom: 10px;"><%= f.title %></h3>
          <p style="font-size: 15px; opacity: 0.85;"><%= f.desc %></p>
        </div>
      <% }) %>
    </div>
  </section>

  <!-- üèÜ BADGES EXAMPLES -->
<section style="background: #f0f4f0; padding: 80px 20px;">
  <h2 style="text-align: center; color: #2f5233; font-size: 32px; font-weight: 600; margin-bottom: 40px;">
    üèÜ Badge Examples
  </h2>
  <div style="
    max-width: 1000px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    text-align: center;
  ">
    <% const exampleBadges = [
      { icon: '/image/community.jpg', title: 'Community Service', desc: 'Awarded for volunteering and helping your local community.' },
      { icon: '/image/cam pro.jpg', title: 'Camping Pro', desc: 'Earned by completing outdoor camping adventures.' },
      { icon: '/image/lead star.jpg', title: 'Leadership Star', desc: 'Given to scouts who demonstrate strong leadership skills.' },
      { icon: '/image/first aid.jpg', title: 'First Aid Ready', desc: 'Given for learning essential first aid skills.' }
    ]; %>
    <% exampleBadges.forEach(badge => { %>
      <div style="
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        display: flex;
        flex-direction: column;
        align-items: center;
      ">
        <img src="<%= badge.icon %>" alt="<%= badge.title %>" style="width: 60px; height: 60px; margin-bottom: 10px;">
        <h4 style="color: #2f5233; font-size: 16px; font-weight: 500; margin-bottom: 6px;"><%= badge.title %></h4>
        <p style="font-size: 14px; opacity: 0.85;"><%= badge.desc %></p>
      </div>
    <% }) %>
  </div>
</section>


  <!-- üìÖ EVENTS -->
  <section style="background: #ffffff; padding: 80px 20px;">
    <h2 style="text-align: center; color: #2f5233; font-size: 32px; font-weight: 600; margin-bottom: 40px;">üìÖ Upcoming Events</h2>
    <% if (events && events.length > 0) { %>
      <div style="
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 25px;
      ">
        <% events.slice(0, 4).forEach(event => { %>
          <div style="
            background: #f9faf9;
            border-radius: 12px;
            border-left: 4px solid #2f5233;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
          ">
            <div style="font-size: 14px; color: #666;"><%= event.date.toDateString() %> ‚Ä¢ <%= event.time %></div>
            <h3 style="font-size: 18px; color: #2f5233; margin: 10px 0;"><%= event.title %></h3>
            <p><strong>üìç</strong> <%= event.location %></p>
            <p style="font-size: 14px; opacity: 0.8;"><%= event.description %></p>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <p style="text-align: center; color: #2f5233;">No upcoming events.</p>
    <% } %>
  </section>

  <!-- üì∏ GALLERY -->
  <section style="background: #ffffff; padding: 80px 20px;">
  <h2 style="text-align: center; color: #2f5233; font-size: 32px; font-weight: 600; margin-bottom: 40px;">
    üì∏ Recent Memories
  </h2>
  <div id="memoryCarousel" class="carousel slide" data-bs-ride="carousel" style="max-width: 1000px; margin: 0 auto;">
    <div class="carousel-inner" style="border-radius: 12px; overflow: hidden;">
      <% const carouselImages = [
        { src: '/image/bg1.jpg', caption: 'Tree Planting Activity' },
        { src: '/image/Community.jpg', caption: 'Camping in Naujan' },
        { src: '/image/b1.jpg', caption: 'Leadership Workshop' },
        { src: '/image/lead.jpg', caption: 'Badge Award Ceremony' }
      ]; %>
      <% carouselImages.forEach((img, index) => { %>
        <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
          <img src="<%= img.src %>" class="d-block w-100" alt="<%= img.caption %>" style="object-fit: cover; height: 400px;">
          <div class="carousel-caption d-none d-md-block" style="background: rgba(0,0,0,0.4); border-radius: 6px;">
            <h5><%= img.caption %></h5>
          </div>
        </div>
      <% }) %>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#memoryCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#memoryCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>
</section>


  <!-- üí¨ TESTIMONIALS -->
  <section style="background: #ffffff; padding: 80px 20px;">
    <h2 style="text-align: center; color: #2f5233; font-size: 32px; font-weight: 600; margin-bottom: 40px;">üí¨ What Scouts Say</h2>
    <div style="
      max-width: 800px;
      margin: 0 auto;
      display: grid;
      gap: 20px;
    ">
      <div style="
        background: #f9faf9;
        border-left: 4px solid #2f5233;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      ">
        <p style="font-style: italic; opacity: 0.85;">"Joining the Girl Scouts has made me confident and taught me the value of helping others."</p>
        <p style="margin-top: 10px; font-weight: 500; color: #2f5233;">‚Äì Maria, Cadette</p>
      </div>
      <div style="
        background: #f9faf9;
        border-left: 4px solid #2f5233;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      ">
        <p style="font-style: italic; opacity: 0.85;">"I love earning badges and learning new things with my troop!"</p>
        <p style="margin-top: 10px; font-weight: 500; color: #2f5233;">‚Äì Angela, Brownie</p>
      </div>
    </div>
  </section>

</div>



<% } else { %>
<!-- üåü FULLSCREEN GIRL SCOUT HUB LANDING PAGE -->
<div style="font-family: 'Segoe UI', sans-serif; margin:0; padding:0;">

  <!-- üåü CAROUSEL SECTION -->
  <div id="girlScoutCarousel" class="carousel slide" data-bs-ride="carousel" style="
    position: relative;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
  ">
    <div class="carousel-inner" style="width:100%; height:100%;">
      <div class="carousel-item active">
        <img src="/image/bg.png" class="d-block w-100" alt="Girl Scout 1" style="width:100%; height:100vh; object-fit:cover;">
      </div>
      <div class="carousel-item">
        <img src="/image/bg2.jpg" class="d-block w-100" alt="Girl Scout 2" style="width:100%; height:100vh; object-fit:cover;">
      </div>
      <div class="carousel-item">
        <img src="/image/bg3.jpg" class="d-block w-100" alt="Girl Scout 3" style="width:100%; height:100vh; object-fit:cover;">
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#girlScoutCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#girlScoutCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
    </button>

    <!-- üåü HERO OVERLAY CONTENT -->
    <section style="
      position:absolute;
      top:0;
      left:0;
      width:100vw;
      height:100vh;
      background:rgba(47,82,51,0.6);
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      color:white;
      text-align:center;
      padding:40px 20px;
      z-index:5;
    ">
      <h1 style="font-size:48px; margin-bottom:20px;">Welcome to Girl Scout Hub</h1>
      <p style="font-size:18px; max-width:700px;">
        Empowering girls through leadership, community, and sisterhood.
      </p>
      <a href="#events" style="
        margin-top:30px;
        background:white;
        color:#2f5233;
        padding:14px 30px;
        border-radius:30px;
        font-weight:bold;
        text-decoration:none;
      ">
        View Upcoming Events
      </a>
    </section>
  </div>

  <!-- üìÖ EVENTS SECTION -->
  <section id="events" style="padding:60px 20px; width:100%; background-color:#e0f2e5;">
    <h2 style="font-size:32px; color:#2f5233; text-align:center; margin-bottom:30px;">üìÖ Upcoming Events</h2>

    <% if (events && events.length > 0) { %>
      <div style="
        display:grid;
        grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
        gap:25px;
        max-width:1200px;
        margin:0 auto;
      ">
        <% events.slice(0,3).forEach(event => { %>
          <div style="
            background:#ffffff;
            border-left:6px solid #2f5233;
            border-radius:12px;
            padding:20px;
            box-shadow:0 4px 10px rgba(0,0,0,0.06);
            text-align:left;
          ">
            <div style="font-size:14px; color:#666;"><%= event.date.toDateString() %> ‚Ä¢ <%= event.time %></div>
            <h3 style="color:#2f5233; margin:10px 0;"><%= event.title %></h3>
            <p style="margin:5px 0;"><strong>üìç</strong> <%= event.location %></p>
            <p style="font-size:14px; color:#555;"><%= event.description %></p>
          </div>
        <% }) %>
      </div>
    <% } else { %>
      <p style="text-align:center; color:#2f5233;">No upcoming events.</p>
    <% } %>
  </section>

  <!-- üß≠ ABOUT CTA SECTION -->
  <section style="background-color:#d2e7d7; width:100%; padding:60px 20px;">
    <div style="max-width:1000px; margin:0 auto; text-align:center;">
      <h2 style="color:#2f5233; margin-bottom:20px;">Why Join the Girl Scouts?</h2>
      <p style="font-size:16px; max-width:800px; margin:0 auto; color:#2f5233;">
        Join a movement that builds girls of courage, confidence, and character. From earning badges to helping the community‚ÄîGirl Scouts create real impact.
      </p>
      <a href="auth/register" style="
        margin-top:30px;
        display:inline-block;
        background:#2f5233;
        color:white;
        padding:12px 28px;
        border-radius:30px;
        font-weight:bold;
        text-decoration:none;
      ">
        Join Now
      </a>
    </div>
  </section>

  <!-- üåø ABOUT PLANTING SECTION -->
  <section style="background-color:#f3f8f4; width:100%; padding:60px 20px;">
    <div style="max-width:1200px; margin:0 auto;">
      <h2 style="color:#2f5233; text-align:center; margin-bottom:40px;">üåø About Planting</h2>
      <div style="
        display:flex;
        flex-wrap:wrap;
        justify-content:center;
        gap:20px;
      ">
        <% const plantingCards = [
          {title:'Tree Planting', description:'Helping restore the environment through planting native trees in school and community spaces.'},
          {title:'Gardening', description:'Promoting food security and responsibility by maintaining troop gardens with fresh vegetables and herbs.'},
          {title:'Composting', description:'Teaching waste reduction and proper biodegradable waste handling through composting practices.'},
          {title:'Environmental Awareness', description:'Learning about biodiversity, climate action, and sustainable living to protect our future planet.'}
        ]; %>
        <% plantingCards.forEach(card => { %>
          <div style="
            background:white;
            border-radius:12px;
            box-shadow:0 4px 10px rgba(0,0,0,0.06);
            overflow:hidden;
            flex:1 1 calc(25% - 20px);
            min-width:250px;
            max-width:270px;
          ">
            <img src="/image/bg2.jpg" alt="<%= card.title %>" style="width:100%; height:180px; object-fit:cover;">
            <div style="padding:15px;">
              <h3 style="color:#2f5233; font-size:18px;"><%= card.title %></h3>
              <p style="font-size:14px; color:#444;"><%= card.description %></p>
            </div>
          </div>
        <% }) %>
      </div>
    </div>
  </section>

  <!-- üì© FOOTER -->
  <footer style="background-color:#2f5233; color:white; text-align:center; padding:30px 20px; width:100%;">
    <p>&copy; <%= new Date().getFullYear() %> Girl Scout Hub. All rights reserved.</p>
  </footer>

</div>
<% } %>

</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Existing data
const salesData = <%- JSON.stringify(topProducts || []) %>;
const salesByCategory = <%- JSON.stringify(productSales || []) %>;
const totalRevenue = <%- totalRevenue %>;
const totalOrders = <%- totalOrders %>;

// Monthly, Weekly, Yearly data
const monthlyData = <%- JSON.stringify(monthlyData || []) %>;
const weeklyData = <%- JSON.stringify(weeklyData || []) %>;
const yearlyData = <%- JSON.stringify(yearlyData || []) %>;
const topCategoriesPerMonth = <%- JSON.stringify(topCategoriesPerMonth || []) %>;

// Helper functions
function formatMonth(monthNum, year) {
  const date = new Date(year, monthNum-1);
  return date.toLocaleString('default', { month: 'long', year: 'numeric' });
}
function formatWeek(week, year) {
  return `Week ${week}, ${year}`;
}
function formatYear(year) {
  return `${year}`;
}

// üîπ Top Products Chart
const topProductsCtx = document.getElementById('topProductsChart')?.getContext('2d');
if(topProductsCtx){
  new Chart(topProductsCtx,{
    type:'bar',
    data:{
      labels:salesData.map(p=>p._id),
      datasets:[{label:'Quantity Sold',data:salesData.map(p=>p.totalSold),backgroundColor:'#43a047'}]
    },
    options:{plugins:{legend:{display:false}},responsive:true,scales:{y:{beginAtZero:true}}}
  });
}

// üîπ Sales by Category Chart
const salesByCategoryCtx = document.getElementById('salesByCategoryChart')?.getContext('2d');
if(salesByCategoryCtx){
  new Chart(salesByCategoryCtx,{
    type:'pie',
    data:{
      labels:salesByCategory.map(c=>c._id),
      datasets:[{data:salesByCategory.map(c=>c.totalSales),backgroundColor:['#1b5e20','#43a047','#66bb6a','#a5d6a7','#c8e6c9']}]
    },
    options:{plugins:{legend:{position:'bottom'}},responsive:true}
  });
}

// üîπ Revenue Trends Chart (Weekly / Monthly / Yearly)
let revenueChart = null;
function renderRevenueChart(type){
  let data, labels;
  if(type==="monthly"){
    data = monthlyData;
    labels = data.map(m => formatMonth(m._id.month, m._id.year));
  } else if(type==="weekly"){
    data = weeklyData;
    labels = data.map(w => formatWeek(w._id.week, w._id.year));
  } else {
    data = yearlyData;
    labels = data.map(y => formatYear(y._id.year));
  }

  const ctx = document.getElementById('revenueTrendsChart')?.getContext('2d');
  if(!ctx) return;
  if(revenueChart) revenueChart.destroy();

  if(!data || data.length===0){
    revenueChart = new Chart(ctx,{
      type:'bar',
      data:{ labels:["No Data"], datasets:[{label:"Revenue",data:[0]}] },
      options:{ plugins:{legend:{display:false}}, responsive:true }
    });
    return;
  }

  revenueChart = new Chart(ctx,{
    type:'line',
    data:{
      labels,
      datasets:[{
        label:'Revenue (‚Ç±)',
        data:data.map(d=>d.revenue),
        borderColor:'#1b5e20',
        backgroundColor:'rgba(27,94,32,0.2)',
        tension:0.4,
        fill:true
      },{
        label:'Orders',
        data:data.map(d=>d.orders),
        borderColor:'#43a047',
        backgroundColor:'rgba(67,160,71,0.2)',
        tension:0.4,
        fill:true
      }]
    },
    options:{
      plugins:{legend:{position:'top'}},
      scales:{y:{beginAtZero:true}}
    }
  });
}
renderRevenueChart("monthly");
document.getElementById('revenueTrendSelect')?.addEventListener('change', e=>{
  renderRevenueChart(e.target.value);
});

// üîπ Analytics Modal Text 
const analyticsModalBody = document.getElementById('analyticsModalBody');
if (analyticsModalBody) {
  // sort descending by totalSold, then take top 3
  const top3 = salesData
    .sort((a, b) => b.totalSold - a.totalSold)
    .slice(0, 3);

  const analyticsContent = `
    <p><strong>Total Sales Orders:</strong> ${totalOrders}</p>
    <h4>Top 3 Sales Orders:</h4>
    <ul>
      ${top3.map(p => `<li><strong>${p._id}</strong>: ${p.totalSold} sold</li>`).join('')}
    </ul>
  `;

  analyticsModalBody.insertAdjacentHTML('afterbegin', analyticsContent);
}
</script>
