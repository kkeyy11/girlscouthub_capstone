<%- include('./layouts/header') %>
<%- include('./layouts/navbar') %>


<style>


</style>
<main style="
 
<% if (user && user.role && user.role.toLowerCase() === 'admin') { %>
<!-- ‚úÖ MAIN DASHBOARD CONTAINER -->
<div class="dashboard-container">

  <!-- ‚úÖ SUMMARY CARDS (Horizontal Row) -->
  <div class="summary-row">
    <div class="custom-card blue-card">
      <h3>Total Districts</h3>
      <h2><%= districtCount %></h2>
      <p><span class="trend up">‚ñ≤ 5%</span> this month</p>
    </div>

    <div class="custom-card yellow-card">
      <h3>Total Appointments</h3>
      <h2><%= latestAppointments?.length || 0 %></h2>
      <p><span class="trend up">‚ñ≤ 8%</span> this month</p>
    </div>

    <div class="custom-card pink-card">
      <h3>Total Products</h3>
      <h2><%= productCount %></h2>
      <p><span class="trend down">‚ñº 2%</span> this month</p>
    </div>

    <div class="custom-card green-card">
      <h3>Upcoming Events</h3>
      <h2><%= events.length %></h2>
      <p><span class="trend up">‚ñ≤ 12%</span> this month</p>
    </div>

    <div class="custom-card purple-card">
      <h3>Total Revenue</h3>
      <h2>‚Ç±<%= totalRevenue.toLocaleString() %></h2>
      <p><span class="trend up">‚ñ≤ 15%</span> this month</p>
      <small>Total Orders: <%= totalOrders %></small>
    </div>
  </div>  
</div>

<!-- ‚úÖ CARD DESIGN STYLES -->
<style>
/* ‚úÖ Dashboard Container */
.dashboard-container {
  margin-left: 220px;
  padding: 40px 15px;
  min-height: 100vh;
  background: linear-gradient(to right top, #f9fafb, #f3f4f6);
  font-family: 'Poppins', sans-serif;
}

/* ‚úÖ Horizontal Row for Cards */
.summary-row {
  display: flex;
  gap: 12px;
  margin-top: 15px;
  flex-wrap: nowrap;
  justify-content: space-between;
}

/* ‚úÖ Card Base Style (Compact + Gradient) */
.custom-card {
  flex: 1;
  padding: 15px;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  text-align: left;
  font-weight: bold; /* üî• bold lahat */
  color: #000;       /* üî• black font */
}

.custom-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 14px rgba(0,0,0,0.16);
}

/* ‚úÖ Headings (Black & Bold) */
.custom-card h3 {
  font-size: 12px;
  font-weight: 700;
  margin-bottom: 6px;
  opacity: 0.9;
  color: #000;
}

.custom-card h2 {
  font-size: 20px;
  font-weight: 800;
  margin: 0 0 6px;
  color: #000;
}

.custom-card p {
  font-size: 12px;
  font-weight: 700;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 5px;
  color: #000;
}

.custom-card small {
  display: block;
  margin-top: 4px;
  font-size: 11px;
  font-weight: 600;
  opacity: 0.9;
  color: #000;
}

/* ‚úÖ Trends (percent up/down colors) */
.trend {
  font-weight: 800;
}
.trend.up {
  color: #28a745;
}
.trend.down {
  color: #dc3545;
}

/* ‚úÖ Gradient Variants (Background Colors of Cards) */
.blue-card {
  background: linear-gradient(135deg, #6dd5fa, #2980b9);
}
.yellow-card {
  background: linear-gradient(135deg, #f7971e, #ffd200);
}
.pink-card {
  background: linear-gradient(135deg, #ff6a00, #ee0979);
}
.green-card {
  background: linear-gradient(135deg, #00b09b, #96c93d);
}
.purple-card {
  background: linear-gradient(135deg, #8e2de2, #4a00e0);
}
</style>



<!-- ‚úÖ ANALYTICS SECTION (Second Row) -->
<div class="analytics-grid">
  <!-- üîπ Top Selling Products -->
  <div class="chart-card small-chart">
    <h6>üì¶ Top Selling Products</h6>
    <canvas id="topProductsChart"></canvas>
  </div>

  <!-- üîπ Sales by Category -->
  <div class="chart-card small-chart">
    <h6>üìä Sales by Category</h6>
    <canvas id="salesByCategoryChart"></canvas>
  </div>
  <div class="chart-card wide small-chart">
      <div class="chart-header">
        <h6>Revenue Trends</h6>
        <select id="revenueTrendSelect" class="form-select form-select-sm" style="width:auto;">
          <option value="monthly" selected>Monthly</option>
          <option value="weekly">Weekly</option>
          <option value="yearly">Yearly</option>
        </select>
      </div>
      <canvas id="revenueTrendsChart"></canvas>
    </div>
  </div>


  


  


<style>
.dashboard-container {
  max-width: 1300px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 30px;
  padding-bottom: 40px;
  font-family: 'Poppins', sans-serif;
}

/* ‚úÖ Analytics Grid */
.analytics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
}

/* ‚úÖ Chart Cards */
.chart-card {
  background: #fff;
  border-radius: 15px;
  padding: 18px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.chart-card h6 {
  font-size: 14px;
  font-weight: 700;
  color: #333;
  margin: 0 0 6px;
}

.chart-card.wide {
  grid-column: span 2;
}

/* ‚úÖ Chart Header (Title + Dropdown) */
.chart-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.chart-header select {
  font-size: 12px;
  padding: 2px 6px;
  border-radius: 6px;
}

/* ‚úÖ Chart Size */
.small-chart canvas {
  max-height: 220px !important;
}

/* ‚úÖ Top 3 Sales Orders */
.top-sales {
  display: flex;
  flex-direction: column;
  gap: 8px;
  font-size: 13px;
  font-weight: 600;
  color: #444;
}

</style>









<% } else if (user) { %>

<!-- üå∏ GIRL SCOUT MINDORO USER DASHBOARD -->
<div style="font-family: 'Poppins', sans-serif; background-color: #f5f7fa; color: #333;">

  <!-- üåü HERO SECTION FULL SCREEN -->
  <section class="page-section" style="
    /* Full-screen hero background with gradient overlay */
    background: linear-gradient(to right, rgba(47,82,51,0.9), rgba(30,50,30,0.8)), url('/image/bg1.png') center/cover no-repeat;
    color: white;
    position: relative;
    overflow: hidden;
    height: 100vh; /* FULL SCREEN */
    padding: 0;    /* remove extra spacing */
    display: flex;
    justify-content: center;
    align-items: center;
  ">
    <!-- Decorative floating shapes for subtle animation -->
    <div style="position:absolute; top:10%; left:5%; width:80px; height:80px; background:rgba(255,255,255,0.1); border-radius:50%; animation: float 6s ease-in-out infinite;"></div>
    <div style="position:absolute; bottom:15%; right:8%; width:120px; height:120px; background:rgba(255,255,255,0.08); border-radius:50%; animation: float 8s ease-in-out infinite;"></div>

    <!-- Hero content: greeting, description, and button -->
    <div class="hero-content" style="
      display: flex;
      flex-direction: column;
      justify-content: center; /* vertical centering */
      align-items: center;     /* horizontal centering */
      height: 100%;            /* full height of hero section */
      text-align: center;
      padding: 0 20px;
    ">
      <h1 style="font-size: 56px; font-weight: 800; margin-bottom: 20px; letter-spacing: -1px;">
        Welcome, <%= user.firstName || 'Girl Scout' %>! üåø
      </h1>

      <p style="font-size: 22px; max-width: 800px; opacity: 0.95; line-height: 1.8; margin: 0 auto;">
        Empowering young girls in Mindoro through 
        <span style="color:#ffcc00; font-weight:600;">leadership</span>, 
        <span style="color:#ffcc00; font-weight:600;">service</span>, and 
        <span style="color:#ffcc00; font-weight:600;">sisterhood</span>.
      </p>

      <!-- Button scrolls smoothly to the Gallery section -->
      <!-- <a href="#gallerySection" 
         onclick="event.preventDefault(); document.getElementById('gallerySection').scrollIntoView({ behavior: 'smooth' });"
         style="
            display: inline-block;
            margin-top: 40px;
            background: linear-gradient(135deg, #ffcc00, #ffd633);
            color: #2f5233;
            padding: 16px 36px;
            font-weight: 700;
            font-size: 18px;
            border-radius: 40px;
            text-decoration: none;
            box-shadow: 0 6px 18px rgba(0,0,0,0.25);
            transition: all 0.3s ease;
          " 
         onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 10px 25px rgba(0,0,0,0.35)'" 
         onmouseout="this.style.transform='none'; this.style.boxShadow='0 6px 18px rgba(0,0,0,0.25)'">
          üåü Explore Your Dashboard
      </a> -->
    </div>
  </section>






  <!-- Lightbox Modal -->
  <div id="lightboxModal" style="
    display:none; 
    position:fixed; 
    top:0; left:0; width:100%; height:100%; 
    background:rgba(0,0,0,0.9); 
    justify-content:center; 
    align-items:center; 
    z-index:1000;
  ">
    <span style="
      position:absolute; 
      top:20px; right:30px; 
      color:white; 
      font-size:3rem; 
      cursor:pointer;
    " onclick="closeLightbox()">&times;</span>
    <img id="lightboxImg" src="" style="max-width:90%; max-height:90%; border-radius:10px; box-shadow:0 10px 30px rgba(0,0,0,0.5);">
  </div>

</div>

<!-- <script>
  const carousel = document.getElementById('galleryCarousel');

  function scrollGallery(direction) {
    const cardWidth = carousel.querySelector('.card-carousel').offsetWidth;
    carousel.scrollBy({ left: direction * cardWidth, behavior: 'smooth' });
  }

  function updateCenterCard() {
    const cards = carousel.querySelectorAll('.card-carousel');
    const carouselCenter = carousel.scrollLeft + carousel.offsetWidth / 2;
    cards.forEach(card => {
      const cardCenter = card.offsetLeft + card.offsetWidth / 2;
      const distance = Math.abs(carouselCenter - cardCenter);
      const scale = Math.max(0.85, 1 - distance / 500);
      card.style.transform = `scale(${scale})`;
      card.style.boxShadow = `0 ${8 + (1 - scale) * 20}px ${20 + (1 - scale) * 30}px rgba(34,139,34,${0.15 + (1 - scale) * 0.1})`;
      card.style.border = `1px solid rgba(34,139,34,${scale*0.5})`;
    });
  }

  carousel.addEventListener('scroll', updateCenterCard);
  window.addEventListener('load', updateCenterCard);
  window.addEventListener('resize', updateCenterCard);

  // Lightbox functions
  function openLightbox(src) {
    document.getElementById('lightboxImg').src = src;
    document.getElementById('lightboxModal').style.display = 'flex';
  }
  function closeLightbox() {
    document.getElementById('lightboxModal').style.display = 'none';
  }

  // Close lightbox on click outside image
  document.getElementById('lightboxModal').addEventListener('click', function(e){
    if(e.target.id === 'lightboxModal'){
      closeLightbox();
    }
  });
</script> -->

<style>
  #galleryCarousel { scrollbar-width: none; }
  #galleryCarousel::-webkit-scrollbar { display:none; }

  .nav-btn {
    position: absolute;
    top:50%;
    transform: translateY(-50%);
    border-radius:50%;
    width:50px;
    height:50px;
    z-index:10;
    background: rgba(34,139,34,0.8);
    color:white;
    font-size:1.5rem;
    opacity:0.8;
    transition: all 0.3s ease;
    border:none;
    cursor:pointer;
  }
  .nav-btn:hover { 
    opacity:1; 
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 6px 20px rgba(34,139,34,0.3);
  }
  .nav-btn.left { left:0; }
  .nav-btn.right { right:0; }

  .about-card:hover {
    transform: translateY(-10px) scale(1.05);
    box-shadow: 0 20px 35px rgba(34,139,34,0.2);
    border: 1px solid #22c55e;
  }

  @media (max-width:768px) {
    .card-carousel { min-width:220px; max-width:220px; height:300px; }
  }
  @media (max-width:480px) {
    .card-carousel { min-width:180px; max-width:180px; height:260px; }
  }
</style>





<% } else { %>

<!-- üåü GIRL SCOUT HUB LANDING PAGE FULL SCREEN -->
<div class="landing-page" style="font-family: 'Poppins', sans-serif; overflow:hidden;">
  <section class="hero-section" style="
    position: relative;
    width: 100%;
    height: 100vh;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
  ">

    <!-- ‚úÖ Background Image from DB -->
    <div style="
      position: absolute;
      top:0; left:0;
      width:100%;
      height:100%;
      background: url('<%= siteContent && siteContent.banner && siteContent.banner.path 
        ? siteContent.banner.path 
        : '/images/default-banner.jpg' %>') center/cover no-repeat;
      filter: blur(0.5px);
      z-index:1;
    "></div>

    <!-- Overlay -->
    <div style="
      position: absolute;
      top:0; left:0;
      width:100%;
      height:100%;
      background: rgba(0,0,0,0.2);
      z-index:2;
    "></div>

    <div class="hero-content" style="
      position: relative;
      text-align: center;
      z-index:3;
      padding: 0 20px;
      max-width: 1000px;
    ">
      <h1 style="font-size: 4rem; font-weight: 800; color: white; text-shadow: 2px 2px 6px rgba(0,0,0,0.7);">
        Girl Scouts of the Philippines
      </h1>
      <h3 style="font-size: 2rem; font-weight: 800; color: white; margin-bottom: 40px;">
        Oriental Mindoro
      </h3>
      <a href="#events" class="btn-hoverboard">View Upcoming Events</a>
    </div>
  </section>
</div>

<style>
  .btn-hoverboard {
    display: inline-block;
    padding: 14px 36px;
    font-weight: 700;
    font-size: 1.1rem;
    border-radius: 999px;
    background: linear-gradient(135deg,#16a34a,#065f46);
    color: #fff;
    border: none;
    text-decoration: none;
    transition: transform 0.25s ease, color 0.25s ease;
  }
  .btn-hoverboard:hover {
    color: #16a34a;
    background: #fff;
    transform: scale(1.03);
  }
</style>





<!-- üìÖ EVENTS SECTION ‚Äî Fixed & Premium (Fullscreen) -->
<section id="events"
         class="py-5"
         style="background: linear-gradient(135deg,#f9fafb,#e6f4ea); min-height: 100vh; display:flex; align-items:center;">
  <div class="container" style="max-width:1100px;">
    <h2 class="text-center text-success mb-5 display-5 text-black fw-bold"> Upcoming Events</h2>

    <!-- <h2 class="text-center mb-5 display-5 text-black fw-bold">
  Upcoming Events
</h2> -->


    <% if (Array.isArray(events) && events.length > 0) { %>
      <div class="row g-4 justify-content-center">
        <% events.slice(0,3).forEach(function(event, index) {
             // Server-side: safe dates and Google Calendar URL
             const startDate = new Date(event.date);
             const endDate = new Date(startDate.getTime() + 2*60*60*1000); // +2 hours
             function formatForGCal(d) { return d.toISOString().replace(/[-:]/g,'').split('.')[0] + 'Z'; }
             const gcalUrl = 'https://calendar.google.com/calendar/render?action=TEMPLATE'
               + '&text=' + encodeURIComponent(String(event.title || 'Event'))
               + '&dates=' + formatForGCal(startDate) + '/' + formatForGCal(endDate)
               + '&details=' + encodeURIComponent(String(event.description || ''))
               + '&location=' + encodeURIComponent(String(event.location || ''));
        %>

          <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm event-card p-3 position-relative">

              <!-- Circular Number Badge -->
              <div class="event-badge position-absolute" style="top:-12px; left:-12px;">
                <span class="badge-number"><%= index + 1 %></span>
              </div>

              <div class="card-body p-0">
                <!-- Date & Time -->
                <div class="mb-2 small text-muted d-flex align-items-center">
                  <i class="bi bi-calendar-event text-dark me-2"></i>
                  <%= startDate.toDateString() %> ‚Ä¢ <%= event.time || '' %>
                </div>

                <!-- Title -->
                <h5 class="mb-2 text-success fw-bold small">
                  <i class="bi bi-star-fill text-dark me-1"></i>
                  <%= event.title %>
                </h5>

                <!-- Location -->
                <p class="mb-2 small text-secondary">
                  <i class="bi bi-geo-alt text-dark me-1"></i>
                  <%= event.location %>
                </p>

                <!-- Description -->
                <p class="mb-3 small text-muted">
                  <i class="bi bi-info-circle text-dark me-1"></i>
                  <%= event.description %>
                </p>

                <!-- Countdown (client-side will update) -->
                <p class="fw-bold small mb-2">
                  ‚è≥ Starts in: <span class="text-success countdown" data-start="<%= startDate.toISOString() %>">...</span>
                </p>

                <!-- Add to Calendar (no underline, opens in new tab) -->
                <a href="<%= gcalUrl %>"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="btn-hoverboard d-block text-center mt-2"
                   style="text-decoration:none;">
                  <i class="bi bi-calendar-plus me-2"></i> Add to Calendar
                </a>
              </div>
            </div>
          </div>

        <% }); %>
      </div>
    <% } else { %>
      <p class="text-center text-success">No upcoming events.</p>
    <% } %>
  </div>
</section>

<!-- Styles for events -->
<style>
  .event-card {
    border-radius: 12px;
    background: #fff;
    font-size: 0.92rem;
    transition: transform 0.28s ease, box-shadow 0.28s ease;
    padding-bottom: 14px;
  }
  .event-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 30px rgba(22,163,74,0.18); /* soft green glow */
  }

  /* Circular number badge */
  .badge-number {
    display: inline-block;
    width: 40px;
    height: 40px;
    line-height: 40px;
    border-radius: 50%;
    background: #16a34a;
    color: #fff;
    font-weight: 700;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    font-size: 0.95rem;
  }

  /* Hoverboard button (black overlay -> green text) */
  .btn-hoverboard {
    display: inline-block;
    padding: 10px 14px;
    font-weight: 600;
    font-size: 0.95rem;
    border-radius: 999px;
    background: linear-gradient(135deg,#16a34a,#065f46);
    color: #fff;
    position: relative;
    overflow: hidden;
    z-index: 1;
    transition: transform 0.25s ease, color 0.25s ease;
    border: none;
  }
  .btn-hoverboard::before {
    content: "";
    position: absolute;
    top:0;
    left:-100%;
    width:100%;
    height:100%;
    background: #000;
    transition: left 0.28s ease;
    z-index:-1;
  }
  .btn-hoverboard:hover::before { left: 0; }
  .btn-hoverboard:hover {
    color: #16a34a;
    transform: scale(1.03);
    box-shadow: 0 8px 20px rgba(0,0,0,0.18);
  }
  .btn-hoverboard i { color: inherit; } /* icon uses text color */

  /* Small responsive tweaks */
  @media (max-width: 767px) {
    .badge-number { width:34px; height:34px; line-height:34px; font-size:0.85rem; }
    .event-card { padding: 14px; }
  }
</style>

<!-- Countdown script (single safe client-side script) -->
<script>
  (function () {
    const nodes = document.querySelectorAll('.countdown');
    if (!nodes.length) return;

    function updateOne(el) {
      const startStr = el.dataset.start;
      if (!startStr) { el.textContent = ''; return; }
      const start = new Date(startStr).getTime();
      const now = Date.now();
      const dist = start - now;
      if (dist <= 0) { el.textContent = 'Event started'; return; }
      const days = Math.floor(dist / (1000 * 60 * 60 * 24));
      const hours = Math.floor((dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const mins = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60));
      el.textContent = (days > 0 ? days + 'd ' : '') + hours + 'h ' + mins + 'm';
    }

    // initial update
    nodes.forEach(updateOne);
    // update every minute
    setInterval(() => nodes.forEach(updateOne), 60 * 1000);
  })();
</script>

  



<!-- üå± ABOUT US SECTION -->
<section class="py-5 aboutus-section position-relative overflow-hidden">
  <!-- Floating leaves background -->
  <div class="floating-leaves">
    <i class="fa-solid fa-leaf leaf leaf1"></i>
    <i class="fa-solid fa-leaf leaf leaf2"></i>
    <i class="fa-solid fa-leaf leaf leaf3"></i>
    <i class="fa-solid fa-leaf leaf leaf4"></i>
  </div>

  <div class="container px-5 position-relative">
    <h2 class="text-center mb-5 display-5 text-black fw-bold">
      <i class=""></i> About Us
    </h2>

    <div class="row g-4 justify-content-center">
      <% const aboutCards = [
        {icon:'fa-campground', title:'Camps', description:'Camping provides adventures that prepare Girl Scouts for life. Camps develop positive values, leadership, friendliness, and willingness to serve.'},
        {icon:'fa-book', title:'Programs', description:'The GSP Program provides space for a girl to maximize her fullest potential to become a responsible and productive member of society.'},
        {icon:'fa-chalkboard-teacher', title:'Training', description:'Adult members receive opportunities to be trained and empowered as human resource base for the Organization.'},
        {icon:'fa-users', title:'Membership', description:'Girls, young women, and adults who believe in Girl Scouting and accept the principles embodied in the Girl Scout Promise and Law are welcome to be members of GSP.'}
      ]; %>

      <% aboutCards.forEach(card => { %>
        <div class="col-sm-6 col-md-4 col-lg-3 d-flex">
          <div class="card about-card border-0 rounded-4 text-center p-4 fade-in flex-fill">
            <div class="icon-circle mb-3">
              <i class="fa-solid <%= card.icon %>"></i>
            </div>
            <h5 class="card-title text-black fw-bold"><%= card.title %></h5>
            <p class="card-text small"><%= card.description %></p>
          </div>
        </div>
      <% }) %>
    </div>
  </div>
</section>

<style>
/* üåø Section background */
.aboutus-section {
  width: 100%;
  background: #f8fdf5;
  min-height: 100vh;
  position: relative;
  display: flex;
  align-items: center;
  overflow: hidden;
}

/* üåø Floating leaves */
.floating-leaves .leaf {
  position: absolute;
  font-size: 2rem;
  color: #22c55e;
  opacity: 0.15;
  animation: floatLeaf 12s linear infinite;
}

.leaf1 { top: 10%; left: -50px; animation-delay: 0s; }
.leaf2 { top: 30%; right: -60px; animation-delay: 3s; }
.leaf3 { bottom: 20%; left: -40px; animation-delay: 6s; }
.leaf4 { bottom: 10%; right: -50px; animation-delay: 9s; }

@keyframes floatLeaf {
  0% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(50px) rotate(180deg); }
  100% { transform: translateY(0) rotate(360deg); }
}

/* üå± Card styling */
.about-card {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  height: 100%; /* ensures equal card height */
  position: relative;
  background: linear-gradient(145deg, #ffffff, #f0fff4);
  border-radius: 20px;
  padding: 2rem 1.5rem;
  color: #000;
  transition: all 0.4s ease;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  z-index: 1;
  overflow: hidden;
}

.about-card:hover {
  transform: translateY(-10px) scale(1.05);
  box-shadow: 0 20px 35px rgba(34, 139, 34, 0.2);
  border: 1px solid #22c55e;
}

/* üåü Icon styling */
.icon-circle {
  width: 70px;
  height: 70px;
  background: #d1fae5;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 15px auto; /* ensures same spacing below icon */
  font-size: 1.8rem;
  color: #16a34a;
  flex-shrink: 0;
  transition: transform 0.4s ease, box-shadow 0.4s ease;
}

.about-card:hover .icon-circle {
  transform: scale(1.15) rotate(10deg);
  box-shadow: 0 8px 25px rgba(22,163,74,0.3);
}

/* Typography */
.card-title {
  font-size: 1.25rem;
  margin-top: 12px;
}

.card-text {
  font-size: 0.95rem;
  line-height: 1.6;
  color: #1f2937;
}

/* Fade-in animation on scroll */
.fade-in {
  opacity: 0;
  transform: translateY(30px);
  animation: fadeInUp 1s forwards;
  animation-delay: 0.2s;
}

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Responsive tweaks */
@media (max-width: 768px) {
  .about-card { padding: 1.5rem 1rem; }
  .icon-circle { width: 60px; height: 60px; font-size: 1.5rem; }
  .floating-leaves .leaf { font-size: 1.5rem; }
}
</style>





<!-- üåü Gallery Section Full Screen -->
<section id="gallerySection" class="page-section" style="
  background:#f8f9fa; 
  display:flex; 
  flex-direction:column; 
  justify-content:center; 
  align-items:center; 
  overflow:hidden;
  min-height:100vh; 
  padding:60px 0; 
">
  <h2 class="fw-bold text-center mb-5" style="font-size:2.5rem; color:#000;">Recent Activities</h2>

  <% if (siteContent && siteContent.gallery && siteContent.gallery.length > 0) { %>
    <div class="carouselWrapper" style="position:relative; width:100%; max-width:1200px; overflow:hidden;">
      
      <div id="carouselInner" style="display:flex; transition: transform 0.5s ease; align-items:center;">
        <% siteContent.gallery.forEach((img, index) => { %>
          <div class="carouselItem" style="flex:0 0 33.333%; display:flex; justify-content:center; align-items:center;">
            <img src="/uploads/<%= img.filename %>" class="carouselImage" style="
              width:70%;
              height:350px;
              object-fit:cover;
              border-radius:10px;
              box-shadow:0 10px 30px rgba(0,0,0,0.2);
              transition: all 0.5s ease;
              cursor:pointer;
            " alt="<%= img.caption %>" onclick="openModal('<%= img.filename %>')">
          </div>
        <% }) %>
      </div>

      <button class="nav-btn left" onclick="moveCarousel(-1)">&#10094;</button>
      <button class="nav-btn right" onclick="moveCarousel(1)">&#10095;</button>

    </div>
  <% } else { %>
    <p class="text-center text-muted" style="font-size:1rem;">No gallery images available.</p>
  <% } %>
</section>

<!-- Modal for full-size image -->
<div id="imageModal" style="
  display:none;
  position:fixed;
  z-index:1000;
  left:0;
  top:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.9);
  justify-content:center;
  align-items:center;
">
  <span style="
    position:absolute;
    top:20px;
    right:40px;
    font-size:40px;
    color:white;
    cursor:pointer;
  " onclick="closeModal()">&times;</span>
  <img id="modalImage" src="" style="max-width:90%; max-height:90%; border-radius:10px;">
</div>

<script>
  // Safely get gallery from EJS
  const gallery = <%- JSON.stringify(siteContent?.gallery || []) %>;
  let currentIndex = 0;

  // Get carousel elements safely
  const carousel = document.getElementById('galleryCarousel');
  const lightboxModal = document.getElementById('lightboxModal');
  const lightboxImg = document.getElementById('lightboxImg');

  // Scroll gallery function
  function scrollGallery(direction) {
    if (!carousel) return;
    const firstCard = carousel.querySelector('.card-carousel');
    if (!firstCard) return;
    const cardWidth = firstCard.offsetWidth;
    carousel.scrollBy({ left: direction * cardWidth, behavior: 'smooth' });
  }

  // Center scaling effect
  function updateCenterCard() {
    if (!carousel) return;
    const cards = carousel.querySelectorAll('.card-carousel');
    if (!cards || cards.length === 0) return;

    const carouselCenter = carousel.scrollLeft + carousel.offsetWidth / 2;
    cards.forEach(card => {
      const cardCenter = card.offsetLeft + card.offsetWidth / 2;
      const distance = Math.abs(carouselCenter - cardCenter);
      const scale = Math.max(0.85, 1 - distance / 500);
      card.style.transform = `scale(${scale})`;
      card.style.boxShadow = `0 ${8 + (1 - scale) * 20}px ${20 + (1 - scale) * 30}px rgba(34,139,34,${0.15 + (1 - scale) * 0.1})`;
      card.style.border = `1px solid rgba(34,139,34,${scale*0.5})`;
    });
  }

  if (carousel) {
    carousel.addEventListener('scroll', updateCenterCard);
    window.addEventListener('load', updateCenterCard);
    window.addEventListener('resize', updateCenterCard);
  }

  // Lightbox
  function openLightbox(src) {
    if (!lightboxModal || !lightboxImg) return;
    lightboxImg.src = src;
    lightboxModal.style.display = 'flex';
  }
  function closeLightbox() {
    if (!lightboxModal) return;
    lightboxModal.style.display = 'none';
  }
  if (lightboxModal) {
    lightboxModal.addEventListener('click', e => {
      if (e.target === lightboxModal) closeLightbox();
    });
  }

  // For older carousel (carouselWrapper/carouselInner)
  function updateCarousel() {
    const items = document.querySelectorAll('.carouselImage');
    if (!items || items.length === 0) return;

    const wrapper = document.querySelector('.carouselWrapper');
    const inner = document.getElementById('carouselInner');
    if (!wrapper || !inner) return;

    items.forEach((img, idx) => {
      const pos = idx - currentIndex;
      if(pos === 0) { // CENTER IMAGE
        img.style.width = "120%";
        img.style.height = "auto";
        img.style.objectFit = "contain";
        img.style.transform = "scale(1.1)";
        img.style.opacity = "1";
        img.style.zIndex = "2";
      } else { // SIDE IMAGES
        img.style.width = "70%";
        img.style.height = "350px";
        img.style.objectFit = "cover";
        img.style.transform = "scale(0.7)";
        img.style.opacity = "0.5";
        img.style.zIndex = "1";
      }
    });

    const wrapperWidth = wrapper.offsetWidth;
    const centerOffset = wrapperWidth / 2 - items[currentIndex].offsetWidth / 2;
    inner.style.transform = `translateX(-${items[currentIndex].offsetLeft - centerOffset}px)`;
  }

  function moveCarousel(direction) {
    if (!gallery || gallery.length === 0) return;
    currentIndex += direction;
    if (currentIndex < 0) currentIndex = gallery.length - 1;
    if (currentIndex >= gallery.length) currentIndex = 0;
    updateCarousel();
  }

  // Initialize carousel safely
  if (gallery.length > 0) updateCarousel();

  // Modal functions for old carousel
  function openModal(filename) {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    if (!modal || !modalImg) return;
    modalImg.src = '/uploads/' + filename;
    modal.style.display = 'flex';
  }
  function closeModal() {
    const modal = document.getElementById('imageModal');
    if (!modal) return;
    modal.style.display = 'none';
  }
</script>


<style>
.nav-btn {
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  border-radius:50%;
  width:50px;
  height:50px;
  z-index:10;
  background: rgba(34,139,34,0.8);
  color:white;
  font-size:1.5rem;
  opacity:0.8;
  border:none;
  cursor:pointer;
  transition: all 0.3s ease;
}
.nav-btn:hover { 
  opacity:1; 
  transform: translateY(-50%) scale(1.2);
  box-shadow: 0 6px 20px rgba(34,139,34,0.3);
}
.nav-btn.left { left:10px; }
.nav-btn.right { right:10px; }
</style>




















<!-- üó∫Ô∏è MAP + CONTACT SECTION -->
<section class="py-5" style="background:#f9fafb;">
  <div class="container">
   <h2 class="text-center mb-4 text-black fw-bold">
   Visit Us
</h2>

    <p class="text-center text-muted mb-5">
      Visit our Girl Scout Oriental Mindoro headquarters or get in touch with us.
    </p>

    <div class="row g-4 align-items-center">
      <!-- Map Column -->
      <div class="col-lg-7">
        <div class="ratio ratio-16x9 shadow-sm rounded">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d7848.973784393746!2d121.179247!3d13.413174!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x33bbfbf8f63b5a5d%3A0x2e4f5f30debb0d49!2sCamilmil%2C%20Calapan%20City%2C%20Oriental%20Mindoro!5e0!3m2!1sen!2sph!4v1694256023456!5m2!1sen!2sph"
            width="600"
            height="450"
            style="border:0;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade">
          </iframe>
        </div>
      </div>

      <!-- Contact Info Column -->
      <div class="col-lg-5">
        <div class="card shadow-sm border-0 h-100 rounded-4">
          <div class="card-body p-4">
            <h5 class="fw-bold text-success mb-4">
              <i class="fa-solid fa-address-book me-2"></i> Contact Information
            </h5>

            <!-- Address -->
            <p class="mb-3 d-flex align-items-start contact-item">
              <i class="fa-solid fa-location-dot contact-icon"></i>
              <span>Girl Scouts Oriental Mindoro<br>Camilmil, Calapan City</span>
            </p>

          
            <!-- Yahoo Email -->
            <p class="mb-3 d-flex align-items-center contact-item">
              <i class="fa-brands fa-yahoo contact-icon"></i>
              <a href="mailto:judith_j624@yahoo.com.ph" class="text-dark text-decoration-none">
                judith_j624@yahoo.com.ph
              </a>
            </p>

            <!-- Facebook Page -->
            <p class="mb-3 d-flex align-items-center contact-item">
              <i class="fa-brands fa-facebook contact-icon"></i>
              <a href="https://www.facebook.com/GSPOrMin" target="_blank" class="text-dark text-decoration-none">
                Girl Scouts Oriental Mindoro Facebook Page
              </a>
            </p>


            <!-- Button -->
            <a href="https://www.google.com/maps/dir/?api=1&destination=Camilmil+Calapan+City+Oriental+Mindoro" 
               target="_blank" 
               class="btn btn-success w-100 mt-4 fw-semibold rounded-pill shadow-sm">
              <i class="fa-solid fa-map-location-dot me-2"></i> Get Directions
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Font Awesome CDN -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<!-- Custom Premium Styles -->
<style>
  .contact-item {
    font-size: 1rem;
    line-height: 1.6;
  }
  .contact-icon {
    font-size: 1.5rem;
    margin-right: 12px;
    color: #000; /* Black premium icons */
    width: 28px;
    text-align: center;
  }
  .contact-item a:hover {
    color: #16a34a; /* Hover = Girl Scout green */
    text-decoration: underline;
  }
</style>






  <!-- üì© FOOTER -->
  <footer class="bg-success text-white text-center py-3">
    <p class="mb-0">&copy; <%= new Date().getFullYear() %> Girl Scout Hub. All rights reserved.</p>
  </footer>

</div>

<!-- EXTRA STYLES -->
<style>
  .landing-page {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
  }
  .carousel-img {
    height: 100vh;
    object-fit: cover;
  }
  .hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(47, 82, 51, 0.6);
    color: white;
    padding: 2rem;
    z-index: 5;
  }
  .section-light {
    background-color: #e0f2e5;
  }
  .section-green {
    background-color: #2f5233;
  }
</style>







<% } %>

</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

<script>
// Existing data
const salesData = <%- JSON.stringify(topProducts || []) %>;
const salesByCategory = <%- JSON.stringify(productSales || []) %>;
const totalRevenue = <%- totalRevenue %>;
const totalOrders = <%- totalOrders %>;

// Monthly, Weekly, Yearly data
const monthlyData = <%- JSON.stringify(monthlyData || []) %>;
const weeklyData = <%- JSON.stringify(weeklyData || []) %>;
const yearlyData = <%- JSON.stringify(yearlyData || []) %>;
const topCategoriesPerMonth = <%- JSON.stringify(topCategoriesPerMonth || []) %>;

// Helper functions
function formatMonth(monthNum, year) {
  const date = new Date(year, monthNum-1);
  return date.toLocaleString('default', { month: 'long', year: 'numeric' });
}
function formatWeek(week, year) {
  return `Week ${week}, ${year}`;
}
function formatYear(year) {
  return `${year}`;
}

// üîπ Create gradient
function createGradient(ctx, color1, color2) {
  const gradient = ctx.createLinearGradient(0, 0, 0, 400);
  gradient.addColorStop(0, color1);
  gradient.addColorStop(1, color2);
  return gradient;
}

// üîπ Top Products Chart
const topProductsCtx = document.getElementById('topProductsChart')?.getContext('2d');
if(topProductsCtx){
  const barGradient = createGradient(topProductsCtx, "#43a047", "#a5d6a7");

  new Chart(topProductsCtx,{
    type:'bar',
    data:{
      labels:salesData.map(p=>p._id),
      datasets:[{
        label:'Quantity Sold',
        data:salesData.map(p=>p.totalSold),
        backgroundColor:barGradient,
        borderRadius:12,
        borderSkipped:false
      }]
    },
    options:{
      plugins:{legend:{display:false}},
      responsive:true,
      scales:{
        y:{beginAtZero:true, ticks:{color:"#2e7d32"}},
        x:{ticks:{color:"#2e7d32"}}
      }
    }
  });
}

// üîπ Sales by Category Chart (with %)
const salesByCategoryCtx = document.getElementById('salesByCategoryChart')?.getContext('2d');
if(salesByCategoryCtx){
  const totalCategorySales = salesByCategory.reduce((sum,c)=>sum+c.totalSales,0);

  new Chart(salesByCategoryCtx,{
    type:'doughnut',
    data:{
      labels:salesByCategory.map(c=>c._id),
      datasets:[{
        data:salesByCategory.map(c=>c.totalSales),
        backgroundColor:['#1b5e20','#2e7d32','#43a047','#66bb6a','#a5d6a7'],
        borderWidth:2,
        borderColor:"#fff"
      }]
    },
    options:{
      cutout:"65%",
      responsive:true,
      plugins:{
        legend:{position:'bottom', labels:{color:"#2e7d32"}},
        tooltip:{
          callbacks:{
            label:function(context){
              const value = context.raw;
              const percentage = ((value / totalCategorySales) * 100).toFixed(1) + '%';
              return `${context.label}: ${value} (${percentage})`;
            }
          }
        },
        datalabels:{
          color:'#fff',
          font:{weight:'bold', size:11},
          formatter:(value)=>{
            let percentage = (value / totalCategorySales * 100).toFixed(1) + "%";
            return percentage;
          }
        }
      }
    },
    plugins:[ChartDataLabels] // ‚¨ÖÔ∏è important para gumana
  });
}



// ‚úÖ Revenue Trends Chart (Inspired by your uploaded design)
let revenueChart = null;

function renderRevenueChart(type) {
  let data, labels;
  if (type === "monthly") {
    data = monthlyData;
    labels = data.map(m => formatMonth(m._id.month, m._id.year).split(" ")[0]); 
  } else if (type === "weekly") {
    data = weeklyData;
    labels = data.map(w => formatWeek(w._id.week, w._id.year));
  } else {
    data = yearlyData;
    labels = data.map(y => formatYear(y._id.year));
  }

  const ctx = document.getElementById("revenueTrendsChart")?.getContext("2d");
  if (!ctx) return;

  if (revenueChart) revenueChart.destroy();

  if (!data || data.length === 0) {
    revenueChart = new Chart(ctx, {
      type: "bar",
      data: { labels: ["No Data"], datasets: [{ label: "Revenue", data: [0] }] },
      options: { plugins: { legend: { display: false } }, responsive: true }
    });
    return;
  }

  // üåü Gradient fill gaya sa inspo image
  const gradient = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height);
  gradient.addColorStop(0, "rgba(46, 125, 50, 0.35)");
  gradient.addColorStop(0.7, "rgba(46, 125, 50, 0.08)");
  gradient.addColorStop(1, "rgba(46, 125, 50, 0)");

  revenueChart = new Chart(ctx, {
    type: "line",
    data: {
      labels,
      datasets: [{
        label: "Revenue",
        data: data.map(d => d.revenue),
        borderColor: "#2e7d32",
        backgroundColor: gradient,
        fill: true,
        tension: 0.4,   // smooth curve gaya ng nasa image
        borderWidth: 3, // medyo bold ang line gaya ng inspo
        pointRadius: 0, // walang bilog na point (malinis look)
        pointHoverRadius: 6,
        pointHoverBackgroundColor: "#2e7d32"
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }, // walang legend sa taas
        tooltip: {
          backgroundColor: "#2e7d32",
          titleColor: "#fff",
          bodyColor: "#fff",
          displayColors: false,
          callbacks: {
            title: (ctx) => labels[ctx[0].dataIndex],
            label: (ctx) => `‚Ç± ${ctx.raw.toLocaleString()}`
          }
        }
      },
      scales: {
        x: {
          grid: { display: false, drawBorder: false }, // walang vertical grid
          ticks: {
            color: "#444",
            font: { size: 13, family: "'Segoe UI', sans-serif" }
          }
        },
        y: {
          grid: { color: "rgba(0,0,0,0.05)", drawBorder: false }, // light grid
          ticks: {
            color: "#666",
            font: { size: 13, family: "'Segoe UI', sans-serif" },
            callback: (val) => val >= 1000 ? (val / 1000) + "k" : val
          }
        }
      },
      elements: {
        line: { borderJoinStyle: "round" }
      }
    }
  });
}

renderRevenueChart("monthly");

// Dropdown change
document.getElementById("revenueTrendSelect")?.addEventListener("change", e => {
  renderRevenueChart(e.target.value);
});


// keep analytics insertion
analyticsModalBody.insertAdjacentHTML('afterbegin', analyticsContent);

</script>
