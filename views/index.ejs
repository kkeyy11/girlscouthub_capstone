<%- include('./layouts/header') %>
<%- include('./layouts/navbar') %>


<style>


</style>
<main style="
 
<% if (user && user.role && user.role.toLowerCase() === 'admin') { %>

<!-- ‚úÖ MAIN DASHBOARD CONTAINER -->
<div class="dashboard-container">

  <!-- ‚úÖ SUMMARY CARDS (Top Row) -->
  <div class="summary-grid">
    <div class="custom-card">
      <h2><%= districtCount %></h2>
      <p>Total Districts</p>
    </div>
    <div class="custom-card">
      <h2><%= latestAppointments?.length || 0 %></h2>
      <p>Total Appointments</p>
    </div>
    <div class="custom-card">
      <h2><%= productCount %></h2>
      <p>Total Products</p>
    </div>
    <div class="custom-card">
      <h2><%= events.length %></h2>
      <p>Upcoming Events</p>
    </div>
    <div class="custom-card revenue-card">
      <h2>‚Ç±<%= totalRevenue.toLocaleString() %></h2>
      <p>Total Revenue</p>
      <small>Total Sales Orders: <%= totalOrders %></small>
    </div>
  </div>

  <!-- ‚úÖ ANALYTICS SECTION (Second Row) -->
  <div class="analytics-grid">
    <div class="chart-card small-chart">
      <h6>Top Selling Products</h6>
      <canvas id="topProductsChart"></canvas>
    </div>
    <div class="chart-card small-chart">
      <h6>Sales by Category</h6>
      <canvas id="salesByCategoryChart"></canvas>
    </div>
    <div class="chart-card wide small-chart">
      <div class="chart-header">
        <h6>Revenue Trends</h6>
        <select id="revenueTrendSelect" class="form-select form-select-sm" style="width:auto;">
          <option value="monthly" selected>Monthly</option>
          <option value="weekly">Weekly</option>
          <option value="yearly">Yearly</option>
        </select>
      </div>
      <canvas id="revenueTrendsChart"></canvas>
    </div>
  </div>

  <!-- ‚úÖ TOP 3 SALES ORDERS (Third Row) -->
  <div class="chart-card small-chart">
    <h6>üèÜ Top 3 Sales Orders</h6>
    <div id="topSalesContainer"></div>
  </div>

  <!-- ‚úÖ LATEST APPOINTMENTS (Fourth Row) -->
  <section class="appointments-section">
    <h2>Latest Appointments</h2>
    <% if (latestAppointments && latestAppointments.length > 0) { %>
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-success">
            <tr>
              <th>User</th>
              <th>Date</th>
              <th>Time</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <% latestAppointments.forEach(app => { %>
              <tr>
                <td><%= app.user ? app.user.firstName + ' ' + app.user.lastName : 'N/A' %></td>
                <td><%= app.date.toDateString() %></td>
                <td><%= app.time %></td>
                <td>
                  <span class="badge bg-<%= app.status === 'Confirmed' ? 'success' : app.status === 'Cancelled' ? 'danger' : 'secondary' %>">
                    <%= app.status %>
                  </span>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    <% } else { %>
      <p class="text-muted">No recent appointments found.</p>
    <% } %>
  </section>

</div>

<style>
.dashboard-container {
  max-width: 1300px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 30px;
  padding-bottom: 40px;
}

/* SUMMARY CARDS */
.summary-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
}

/* ANALYTICS GRID */
.analytics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
}
.chart-card {
  background: #fff;
  border-radius: 15px;
  padding: 15px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}
.chart-card.wide {
  grid-column: span 2;
}
/* Smaller chart size */
.small-chart canvas {
  max-height: 220px !important;
}

/* APPOINTMENTS */
.appointments-section {
  background:#fff;
  padding:20px;
  border-radius:15px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1);
}
</style>





<% } else if (user) { %>
<!-- üå∏ GIRL SCOUT MINDORO USER DASHBOARD -->
<div style="font-family: 'Poppins', sans-serif; background-color: #f5f7fa; color: #333;">



  <!-- üåü HERO SECTION -->
  <section style="
    width: 100%;
    min-height: 100vh;
    background: linear-gradient(to right, rgba(47,82,51,0.9), rgba(30,50,30,0.8)), url('/image/bg1.png') center/cover no-repeat;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 80px 20px;
    color: white;
    position: relative;
    overflow: hidden;
  ">
    <!-- Decorative floating shapes -->
    <div style="position:absolute; top:10%; left:5%; width:80px; height:80px; background:rgba(255,255,255,0.1); border-radius:50%; animation: float 6s ease-in-out infinite;"></div>
    <div style="position:absolute; bottom:15%; right:8%; width:120px; height:120px; background:rgba(255,255,255,0.08); border-radius:50%; animation: float 8s ease-in-out infinite;"></div>

    <h1 style="font-size: 56px; font-weight: 800; margin-bottom: 20px; letter-spacing: -1px;">
      Welcome, <%= user.firstName || 'Girl Scout' %>! üåø
    </h1>
    <p style="font-size: 22px; max-width: 800px; opacity: 0.95; line-height: 1.8; margin: 0 auto;">
      Empowering young girls in Mindoro through <span style="color:#ffcc00; font-weight:600;">leadership</span>, 
      <span style="color:#ffcc00; font-weight:600;">service</span>, and 
      <span style="color:#ffcc00; font-weight:600;">sisterhood</span>.
    </p>
    <a href="#features" style="
      display: inline-block;
      margin-top: 40px;
      background: linear-gradient(135deg, #ffcc00, #ffd633);
      color: #2f5233;
      padding: 16px 36px;
      font-weight: 700;
      font-size: 18px;
      border-radius: 40px;
      text-decoration: none;
      box-shadow: 0 6px 18px rgba(0,0,0,0.25);
      transition: all 0.3s ease;
    " onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 10px 25px rgba(0,0,0,0.35)'" 
       onmouseout="this.style.transform='none'; this.style.boxShadow='0 6px 18px rgba(0,0,0,0.25)'">
      üåü Explore Your Dashboard
    </a>
  </section>

  <!-- Animations -->
  <style>
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }
  </style>

    <!-- üîπ Gallery Section (Dynamic) --> 
   <section class="py-5"> 
    <div class="container"> 
      <h2 class="fw-bold text-center mb-4">Gallery</h2> 
      <div class="row g-4"> <% if (siteContent && siteContent.gallery && siteContent.gallery.length > 0) { %> <% siteContent.gallery.forEach(img => { %> 
        <div class="col-md-4"> 
          <div class="card shadow-sm"> 
            <img src="/uploads/<%= img.filename %>" class="card-img-top" alt="Gallery"> <% if (img.caption) { %> 
              <div class="card-body text-center"> <p class="text-muted"><%= img.caption %></p> 
              </div> <% } %> 
            </div> </div> <% }) %> <% } else { %> <p class="text-center text-muted">No gallery images available.</p> <% } %> 
            </div> </div> </section>

</div>


<% } else { %>
<!-- üåü GIRL SCOUT HUB LANDING PAGE -->
<div class="landing-page">

  <!-- üåü CAROUSEL SECTION
  <div id="girlScoutCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img src="/image/bg.png" class="d-block w-100 carousel-img" alt="Girl Scout 1">
      </div>
      <div class="carousel-item">
        <img src="/image/bg2.jpg" class="d-block w-100 carousel-img" alt="Girl Scout 2">
      </div>
      <div class="carousel-item">
        <img src="/image/bg3.jpg" class="d-block w-100 carousel-img" alt="Girl Scout 3">
      </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#girlScoutCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#girlScoutCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
    </button> -->

    <!-- üîπ Banner / Hero Section (Dynamic) -->
<div id="carouselExample" class="carousel slide mb-5">
  <div class="carousel-inner">
    <% if (siteContent && siteContent.bannerImage) { %>
      <div class="carousel-item active">
        <img src="/uploads/<%= siteContent.bannerImage %>" class="d-block w-100" alt="Banner">
        <div class="carousel-caption d-none d-md-block">
          <h1 class="fw-bold">Welcome to Girl Scout Hub</h1>
          <p class="lead">Empowering girls through leadership, community, and sisterhood.</p>
          <a href="#events" class="btn btn-light btn-lg">View Upcoming Events</a>
        </div>
      </div>
    <% } else { %>
      <div class="carousel-item active">
        <img src="/images/default-banner.jpg" class="d-block w-100" alt="Default Banner">
        <div class="carousel-caption d-none d-md-block">
          <h1 class="fw-bold">Welcome to Girl Scout Hub</h1>
          <p class="lead">Empowering girls through leadership, community, and sisterhood.</p>
          <a href="#events" class="btn btn-light btn-lg">View Upcoming Events</a>
        </div>
      </div>
    <% } %>
  </div>
</div>

<!-- üìÖ EVENTS SECTION ‚Äî Fixed & Premium (Fullscreen) -->
<section id="events"
         class="py-5"
         style="background: linear-gradient(135deg,#f9fafb,#e6f4ea); min-height: 100vh; display:flex; align-items:center;">
  <div class="container" style="max-width:1100px;">
    <h2 class="text-center text-success mb-5 display-5 text-black fw-bold"> Upcoming Events</h2>

    <!-- <h2 class="text-center mb-5 display-5 text-black fw-bold">
  Upcoming Events
</h2> -->


    <% if (Array.isArray(events) && events.length > 0) { %>
      <div class="row g-4 justify-content-center">
        <% events.slice(0,3).forEach(function(event, index) {
             // Server-side: safe dates and Google Calendar URL
             const startDate = new Date(event.date);
             const endDate = new Date(startDate.getTime() + 2*60*60*1000); // +2 hours
             function formatForGCal(d) { return d.toISOString().replace(/[-:]/g,'').split('.')[0] + 'Z'; }
             const gcalUrl = 'https://calendar.google.com/calendar/render?action=TEMPLATE'
               + '&text=' + encodeURIComponent(String(event.title || 'Event'))
               + '&dates=' + formatForGCal(startDate) + '/' + formatForGCal(endDate)
               + '&details=' + encodeURIComponent(String(event.description || ''))
               + '&location=' + encodeURIComponent(String(event.location || ''));
        %>

          <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm event-card p-3 position-relative">

              <!-- Circular Number Badge -->
              <div class="event-badge position-absolute" style="top:-12px; left:-12px;">
                <span class="badge-number"><%= index + 1 %></span>
              </div>

              <div class="card-body p-0">
                <!-- Date & Time -->
                <div class="mb-2 small text-muted d-flex align-items-center">
                  <i class="bi bi-calendar-event text-dark me-2"></i>
                  <%= startDate.toDateString() %> ‚Ä¢ <%= event.time || '' %>
                </div>

                <!-- Title -->
                <h5 class="mb-2 text-success fw-bold small">
                  <i class="bi bi-star-fill text-dark me-1"></i>
                  <%= event.title %>
                </h5>

                <!-- Location -->
                <p class="mb-2 small text-secondary">
                  <i class="bi bi-geo-alt text-dark me-1"></i>
                  <%= event.location %>
                </p>

                <!-- Description -->
                <p class="mb-3 small text-muted">
                  <i class="bi bi-info-circle text-dark me-1"></i>
                  <%= event.description %>
                </p>

                <!-- Countdown (client-side will update) -->
                <p class="fw-bold small mb-2">
                  ‚è≥ Starts in: <span class="text-success countdown" data-start="<%= startDate.toISOString() %>">...</span>
                </p>

                <!-- Add to Calendar (no underline, opens in new tab) -->
                <a href="<%= gcalUrl %>"
                   target="_blank"
                   rel="noopener noreferrer"
                   class="btn-hoverboard d-block text-center mt-2"
                   style="text-decoration:none;">
                  <i class="bi bi-calendar-plus me-2"></i> Add to Calendar
                </a>
              </div>
            </div>
          </div>

        <% }); %>
      </div>
    <% } else { %>
      <p class="text-center text-success">No upcoming events.</p>
    <% } %>
  </div>
</section>

<!-- Styles for events -->
<style>
  .event-card {
    border-radius: 12px;
    background: #fff;
    font-size: 0.92rem;
    transition: transform 0.28s ease, box-shadow 0.28s ease;
    padding-bottom: 14px;
  }
  .event-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 30px rgba(22,163,74,0.18); /* soft green glow */
  }

  /* Circular number badge */
  .badge-number {
    display: inline-block;
    width: 40px;
    height: 40px;
    line-height: 40px;
    border-radius: 50%;
    background: #16a34a;
    color: #fff;
    font-weight: 700;
    text-align: center;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    font-size: 0.95rem;
  }

  /* Hoverboard button (black overlay -> green text) */
  .btn-hoverboard {
    display: inline-block;
    padding: 10px 14px;
    font-weight: 600;
    font-size: 0.95rem;
    border-radius: 999px;
    background: linear-gradient(135deg,#16a34a,#065f46);
    color: #fff;
    position: relative;
    overflow: hidden;
    z-index: 1;
    transition: transform 0.25s ease, color 0.25s ease;
    border: none;
  }
  .btn-hoverboard::before {
    content: "";
    position: absolute;
    top:0;
    left:-100%;
    width:100%;
    height:100%;
    background: #000;
    transition: left 0.28s ease;
    z-index:-1;
  }
  .btn-hoverboard:hover::before { left: 0; }
  .btn-hoverboard:hover {
    color: #16a34a;
    transform: scale(1.03);
    box-shadow: 0 8px 20px rgba(0,0,0,0.18);
  }
  .btn-hoverboard i { color: inherit; } /* icon uses text color */

  /* Small responsive tweaks */
  @media (max-width: 767px) {
    .badge-number { width:34px; height:34px; line-height:34px; font-size:0.85rem; }
    .event-card { padding: 14px; }
  }
</style>

<!-- Countdown script (single safe client-side script) -->
<script>
  (function () {
    const nodes = document.querySelectorAll('.countdown');
    if (!nodes.length) return;

    function updateOne(el) {
      const startStr = el.dataset.start;
      if (!startStr) { el.textContent = ''; return; }
      const start = new Date(startStr).getTime();
      const now = Date.now();
      const dist = start - now;
      if (dist <= 0) { el.textContent = 'Event started'; return; }
      const days = Math.floor(dist / (1000 * 60 * 60 * 24));
      const hours = Math.floor((dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const mins = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60));
      el.textContent = (days > 0 ? days + 'd ' : '') + hours + 'h ' + mins + 'm';
    }

    // initial update
    nodes.forEach(updateOne);
    // update every minute
    setInterval(() => nodes.forEach(updateOne), 60 * 1000);
  })();
</script>

  



<!-- üå± ABOUT US SECTION -->
<section class="py-5 aboutus-section position-relative overflow-hidden">
  <!-- Floating leaves background -->
  <div class="floating-leaves">
    <i class="fa-solid fa-leaf leaf leaf1"></i>
    <i class="fa-solid fa-leaf leaf leaf2"></i>
    <i class="fa-solid fa-leaf leaf leaf3"></i>
    <i class="fa-solid fa-leaf leaf leaf4"></i>
  </div>

  <div class="container px-5 position-relative">
    <h2 class="text-center mb-5 display-5 text-black fw-bold">
      <i class=""></i> About Us
    </h2>

    <div class="row g-4 justify-content-center">
      <% const aboutCards = [
        {icon:'fa-campground', title:'Camps', description:'Camping provides adventures that prepare Girl Scouts for life. Camps develop positive values, leadership, friendliness, and willingness to serve.'},
        {icon:'fa-book', title:'Programs', description:'The GSP Program provides space for a girl to maximize her fullest potential to become a responsible and productive member of society.'},
        {icon:'fa-chalkboard-teacher', title:'Training', description:'Adult members receive opportunities to be trained and empowered as human resource base for the Organization.'},
        {icon:'fa-users', title:'Membership', description:'Girls, young women, and adults who believe in Girl Scouting and accept the principles embodied in the Girl Scout Promise and Law are welcome to be members of GSP.'}
      ]; %>

      <% aboutCards.forEach(card => { %>
        <div class="col-sm-6 col-md-4 col-lg-3 d-flex">
          <div class="card about-card border-0 rounded-4 text-center p-4 fade-in flex-fill">
            <div class="icon-circle mb-3">
              <i class="fa-solid <%= card.icon %>"></i>
            </div>
            <h5 class="card-title text-black fw-bold"><%= card.title %></h5>
            <p class="card-text small"><%= card.description %></p>
          </div>
        </div>
      <% }) %>
    </div>
  </div>
</section>

<style>
/* üåø Section background */
.aboutus-section {
  width: 100%;
  background: #f8fdf5;
  min-height: 100vh;
  position: relative;
  display: flex;
  align-items: center;
  overflow: hidden;
}

/* üåø Floating leaves */
.floating-leaves .leaf {
  position: absolute;
  font-size: 2rem;
  color: #22c55e;
  opacity: 0.15;
  animation: floatLeaf 12s linear infinite;
}

.leaf1 { top: 10%; left: -50px; animation-delay: 0s; }
.leaf2 { top: 30%; right: -60px; animation-delay: 3s; }
.leaf3 { bottom: 20%; left: -40px; animation-delay: 6s; }
.leaf4 { bottom: 10%; right: -50px; animation-delay: 9s; }

@keyframes floatLeaf {
  0% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(50px) rotate(180deg); }
  100% { transform: translateY(0) rotate(360deg); }
}

/* üå± Card styling */
.about-card {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  height: 100%; /* ensures equal card height */
  position: relative;
  background: linear-gradient(145deg, #ffffff, #f0fff4);
  border-radius: 20px;
  padding: 2rem 1.5rem;
  color: #000;
  transition: all 0.4s ease;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  z-index: 1;
  overflow: hidden;
}

.about-card:hover {
  transform: translateY(-10px) scale(1.05);
  box-shadow: 0 20px 35px rgba(34, 139, 34, 0.2);
  border: 1px solid #22c55e;
}

/* üåü Icon styling */
.icon-circle {
  width: 70px;
  height: 70px;
  background: #d1fae5;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 15px auto; /* ensures same spacing below icon */
  font-size: 1.8rem;
  color: #16a34a;
  flex-shrink: 0;
  transition: transform 0.4s ease, box-shadow 0.4s ease;
}

.about-card:hover .icon-circle {
  transform: scale(1.15) rotate(10deg);
  box-shadow: 0 8px 25px rgba(22,163,74,0.3);
}

/* Typography */
.card-title {
  font-size: 1.25rem;
  margin-top: 12px;
}

.card-text {
  font-size: 0.95rem;
  line-height: 1.6;
  color: #1f2937;
}

/* Fade-in animation on scroll */
.fade-in {
  opacity: 0;
  transform: translateY(30px);
  animation: fadeInUp 1s forwards;
  animation-delay: 0.2s;
}

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Responsive tweaks */
@media (max-width: 768px) {
  .about-card { padding: 1.5rem 1rem; }
  .icon-circle { width: 60px; height: 60px; font-size: 1.5rem; }
  .floating-leaves .leaf { font-size: 1.5rem; }
}
</style>


<!-- üó∫Ô∏è MAP + CONTACT SECTION -->
<section class="py-5" style="background:#f9fafb;">
  <div class="container">
   <h2 class="text-center mb-4 text-black fw-bold">
   Find Us
</h2>

    <p class="text-center text-muted mb-5">
      Visit our Girl Scout Oriental Mindoro headquarters or get in touch with us.
    </p>

    <div class="row g-4 align-items-center">
      <!-- Map Column -->
      <div class="col-lg-7">
        <div class="ratio ratio-16x9 shadow-sm rounded">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d7848.973784393746!2d121.179247!3d13.413174!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x33bbfbf8f63b5a5d%3A0x2e4f5f30debb0d49!2sCamilmil%2C%20Calapan%20City%2C%20Oriental%20Mindoro!5e0!3m2!1sen!2sph!4v1694256023456!5m2!1sen!2sph"
            width="600"
            height="450"
            style="border:0;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade">
          </iframe>
        </div>
      </div>

      <!-- Contact Info Column -->
      <div class="col-lg-5">
        <div class="card shadow-sm border-0 h-100 rounded-4">
          <div class="card-body p-4">
            <h5 class="fw-bold text-success mb-4">
              <i class="fa-solid fa-address-book me-2"></i> Contact Information
            </h5>

            <!-- Address -->
            <p class="mb-3 d-flex align-items-start contact-item">
              <i class="fa-solid fa-location-dot contact-icon"></i>
              <span>Girl Scouts Oriental Mindoro<br>Camilmil, Calapan City</span>
            </p>

          
            <!-- Yahoo Email -->
            <p class="mb-3 d-flex align-items-center contact-item">
              <i class="fa-brands fa-yahoo contact-icon"></i>
              <a href="mailto:judith_j624@yahoo.com.ph" class="text-dark text-decoration-none">
                judith_j624@yahoo.com.ph
              </a>
            </p>

            <!-- Facebook Page -->
            <p class="mb-3 d-flex align-items-center contact-item">
              <i class="fa-brands fa-facebook contact-icon"></i>
              <a href="https://www.facebook.com/GSPOrMin" target="_blank" class="text-dark text-decoration-none">
                Girl Scouts Oriental Mindoro Facebook Page
              </a>
            </p>


            <!-- Button -->
            <a href="https://www.google.com/maps/dir/?api=1&destination=Camilmil+Calapan+City+Oriental+Mindoro" 
               target="_blank" 
               class="btn btn-success w-100 mt-4 fw-semibold rounded-pill shadow-sm">
              <i class="fa-solid fa-map-location-dot me-2"></i> Get Directions
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Font Awesome CDN -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<!-- Custom Premium Styles -->
<style>
  .contact-item {
    font-size: 1rem;
    line-height: 1.6;
  }
  .contact-icon {
    font-size: 1.5rem;
    margin-right: 12px;
    color: #000; /* Black premium icons */
    width: 28px;
    text-align: center;
  }
  .contact-item a:hover {
    color: #16a34a; /* Hover = Girl Scout green */
    text-decoration: underline;
  }
</style>






  <!-- üì© FOOTER -->
  <footer class="bg-success text-white text-center py-3">
    <p class="mb-0">&copy; <%= new Date().getFullYear() %> Girl Scout Hub. All rights reserved.</p>
  </footer>

</div>

<!-- EXTRA STYLES -->
<style>
  .landing-page {
    font-family: 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
  }
  .carousel-img {
    height: 100vh;
    object-fit: cover;
  }
  .hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(47, 82, 51, 0.6);
    color: white;
    padding: 2rem;
    z-index: 5;
  }
  .section-light {
    background-color: #e0f2e5;
  }
  .section-green {
    background-color: #2f5233;
  }
</style>
<% } %>

</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// Existing data
const salesData = <%- JSON.stringify(topProducts || []) %>;
const salesByCategory = <%- JSON.stringify(productSales || []) %>;
const totalRevenue = <%- totalRevenue %>;
const totalOrders = <%- totalOrders %>;

// Monthly, Weekly, Yearly data
const monthlyData = <%- JSON.stringify(monthlyData || []) %>;
const weeklyData = <%- JSON.stringify(weeklyData || []) %>;
const yearlyData = <%- JSON.stringify(yearlyData || []) %>;
const topCategoriesPerMonth = <%- JSON.stringify(topCategoriesPerMonth || []) %>;

// Helper functions
function formatMonth(monthNum, year) {
  const date = new Date(year, monthNum-1);
  return date.toLocaleString('default', { month: 'long', year: 'numeric' });
}
function formatWeek(week, year) {
  return `Week ${week}, ${year}`;
}
function formatYear(year) {
  return `${year}`;
}

// üîπ Top Products Chart
const topProductsCtx = document.getElementById('topProductsChart')?.getContext('2d');
if(topProductsCtx){
  new Chart(topProductsCtx,{
    type:'bar',
    data:{
      labels:salesData.map(p=>p._id),
      datasets:[{label:'Quantity Sold',data:salesData.map(p=>p.totalSold),backgroundColor:'#43a047'}]
    },
    options:{plugins:{legend:{display:false}},responsive:true,scales:{y:{beginAtZero:true}}}
  });
}

// üîπ Sales by Category Chart
const salesByCategoryCtx = document.getElementById('salesByCategoryChart')?.getContext('2d');
if(salesByCategoryCtx){
  new Chart(salesByCategoryCtx,{
    type:'pie',
    data:{
      labels:salesByCategory.map(c=>c._id),
      datasets:[{data:salesByCategory.map(c=>c.totalSales),backgroundColor:['#1b5e20','#43a047','#66bb6a','#a5d6a7','#c8e6c9']}]
    },
    options:{plugins:{legend:{position:'bottom'}},responsive:true}
  });
}

// üîπ Revenue Trends Chart (Weekly / Monthly / Yearly)
let revenueChart = null;
function renderRevenueChart(type){
  let data, labels;
  if(type==="monthly"){
    data = monthlyData;
    labels = data.map(m => formatMonth(m._id.month, m._id.year));
  } else if(type==="weekly"){
    data = weeklyData;
    labels = data.map(w => formatWeek(w._id.week, w._id.year));
  } else {
    data = yearlyData;
    labels = data.map(y => formatYear(y._id.year));
  }

  const ctx = document.getElementById('revenueTrendsChart')?.getContext('2d');
  if(!ctx) return;
  if(revenueChart) revenueChart.destroy();

  if(!data || data.length===0){
    revenueChart = new Chart(ctx,{
      type:'bar',
      data:{ labels:["No Data"], datasets:[{label:"Revenue",data:[0]}] },
      options:{ plugins:{legend:{display:false}}, responsive:true }
    });
    return;
  }

  revenueChart = new Chart(ctx,{
    type:'line',
    data:{
      labels,
      datasets:[{
        label:'Revenue (‚Ç±)',
        data:data.map(d=>d.revenue),
        borderColor:'#1b5e20',
        backgroundColor:'rgba(27,94,32,0.2)',
        tension:0.4,
        fill:true
      },{
        label:'Orders',
        data:data.map(d=>d.orders),
        borderColor:'#43a047',
        backgroundColor:'rgba(67,160,71,0.2)',
        tension:0.4,
        fill:true
      }]
    },
    options:{
      plugins:{legend:{position:'top'}},
      scales:{y:{beginAtZero:true}}
    }
  });
}
renderRevenueChart("monthly");
document.getElementById('revenueTrendSelect')?.addEventListener('change', e=>{
  renderRevenueChart(e.target.value);
});

// üîπ Analytics Modal Text 
const analyticsModalBody = document.getElementById('analyticsModalBody');
if (analyticsModalBody) {
  // sort descending by totalSold, then take top 3
  const top3 = salesData
    .sort((a, b) => b.totalSold - a.totalSold)
    .slice(0, 3);

  const analyticsContent = `
    <p><strong>Total Sales Orders:</strong> ${totalOrders}</p>
    <h4>Top 3 Sales Orders:</h4>
    <ul>
      ${top3.map(p => `<li><strong>${p._id}</strong>: ${p.totalSold} sold</li>`).join('')}
    </ul>
  `;

  analyticsModalBody.insertAdjacentHTML('afterbegin', analyticsContent);
}
</script>
